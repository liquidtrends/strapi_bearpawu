"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5199],{83119:function(y,l){const t=()=>null;l.Z=t},83196:function(y,l,t){var e=t(32735),s=t(60216),r=t.n(s),a=t(5636),i=t(39161),u=t.n(i),o=t(57269),_=t.n(o),n=t(13478),m=t.n(n);const D=({displayedFilters:p})=>{const[C,A]=(0,e.useState)(!1),{formatMessage:g}=(0,a.useIntl)(),S=(0,e.useRef)(),W=()=>{A(K=>!K)};return e.createElement(e.Fragment,null,e.createElement(i.Box,{paddingTop:1,paddingBottom:1},e.createElement(i.Button,{variant:"tertiary",ref:S,startIcon:e.createElement(o.Filter,null),onClick:W,size:"S"},g({id:"app.utils.filters",defaultMessage:"Filters"})),C&&e.createElement(n.FilterPopoverURLQuery,{displayedFilters:p,isVisible:C,onToggle:W,source:S})),e.createElement(n.FilterListURLQuery,{filtersSchema:p}))};D.propTypes={displayedFilters:r().arrayOf(r().shape({name:r().string.isRequired,metadatas:r().shape({label:r().string}),fieldSchema:r().shape({type:r().string})})).isRequired},l.Z=D},9814:function(y,l,t){var e=t(32735),s=t(5636),r=t(60216),a=t.n(r),i=t(39161),u=t.n(i),o=t(57269),_=t.n(o);const n=({onClick:m})=>{const{formatMessage:D}=(0,s.useIntl)();return e.createElement(i.Button,{onClick:m,startIcon:e.createElement(o.Envelop,null),size:"S"},D({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};n.propTypes={onClick:a().func.isRequired},l.Z=n},62658:function(y,l){const t={firstname:"",lastname:"",email:"",roles:[]};l.Z=t},61358:function(y,l){const t=[];l.Z=t},54865:function(y,l,t){t.r(l),t.d(l,{default:function(){return ge}});var e=t(32735),s=t(13478),r=t(72041),a=t(39161),i=t(5141),u=t(5636),o=t(84968),_=t(60216),n=t.n(_),m=t(57269),D=t(64421);const p=({canDelete:d,headers:M,entriesToDelete:f,onClickDelete:I,onSelectRow:N,withMainAction:h,withBulkActions:B,rows:Q})=>{const{push:T,location:{pathname:Z}}=(0,i.useHistory)(),{formatMessage:P}=(0,u.useIntl)();return e.createElement(a.Tbody,null,Q.map(c=>{const z=f.findIndex(v=>v===c.id)!==-1;return e.createElement(a.Tr,{key:c.id,...(0,s.onRowClick)({fn:()=>T(`${Z}/${c.id}`),condition:B})},h&&e.createElement(a.Td,{...s.stopPropagation},e.createElement(a.BaseCheckbox,{"aria-label":P({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,D.Pp)(c.firstname,c.lastname)}),checked:z,onChange:()=>{N({name:c.id,value:!z})}})),M.map(({key:v,cellFormatter:G,name:R,...F})=>e.createElement(a.Td,{key:v},typeof G=="function"?G(c,{key:v,name:R,formatMessage:P,...F}):e.createElement(a.Typography,{textColor:"neutral800"},c[R]||"-"))),B&&e.createElement(a.Td,null,e.createElement(a.Flex,{justifyContent:"end"},e.createElement(a.IconButton,{onClick:()=>T(`${Z}/${c.id}`),label:P({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,D.Pp)(c.firstname,c.lastname)}),noBorder:!0,icon:e.createElement(m.Pencil,null)}),d&&e.createElement(a.Box,{paddingLeft:1,...s.stopPropagation},e.createElement(a.IconButton,{onClick:()=>I(c.id),label:P({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,D.Pp)(c.firstname,c.lastname)}),noBorder:!0,icon:e.createElement(m.Trash,null)})))))}))};p.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},p.propTypes={canDelete:n().bool,entriesToDelete:n().array,headers:n().array.isRequired,onClickDelete:n().func,onSelectRow:n().func,rows:n().array,withBulkActions:n().bool,withMainAction:n().bool};var C=p,A=t(83196),g=t(41925),S=t(83281),W=t(4397),x=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],O=t(5173),q=O.Ry().shape({firstname:O.Z_().trim().required(s.translatedErrors.required),lastname:O.Z_(),email:O.Z_().email(s.translatedErrors.email).required(s.translatedErrors.required),roles:O.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)}),ee={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}};const $=(()=>window&&window.strapi&&window.strapi.isEE?t(64746).Z:t(62658).Z)(),te=(()=>window&&window.strapi&&window.strapi.isEE?t(43116).Z:t(61358).Z)(),ae=(()=>window&&window.strapi&&window.strapi.isEE?t(28890).Z:t(16325).Z)(),J=d=>{let{queryName:M,onToggle:f}=d;const[I,N]=(0,e.useState)("create"),[h,B]=(0,e.useState)(!1),[Q,T]=(0,e.useState)(null),Z=(0,o.useQueryClient)(),{formatMessage:P}=(0,u.useIntl)(),c=(0,s.useNotification)(),{lockApp:z,unlockApp:v}=(0,s.useOverlayBlocker)(),{post:G}=(0,s.useFetchClient)(),R=(0,o.useMutation)(U=>G("/admin/users",U),{async onSuccess(U){let{data:w}=U;T(w.data.registrationToken),await Z.refetchQueries(M),await Z.refetchQueries(["ee","license-limit-info"]),Y(),B(!1)},onError(U){throw B(!1),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),U},onSettled(){v()}}),F=P({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ne=async(U,w)=>{let{setErrors:X}=w;z(),B(!0);try{await R.mutateAsync(U)}catch(j){v(),j?.response?.data?.error.message==="Email already taken"&&X({email:j.response.data.error.message})}},Y=()=>{E?N(E):f()},{buttonSubmitLabel:k,isDisabled:H,next:E}=ee[I],_e=I==="create"?e.createElement(a.Button,{type:"submit",loading:h},P(k)):e.createElement(a.Button,{type:"button",loading:h,onClick:f},P(k));return e.createElement(a.ModalLayout,{onClose:f,labelledBy:"title"},e.createElement(a.ModalHeader,null,e.createElement(a.Breadcrumbs,{label:F},e.createElement(a.Crumb,null,F))),e.createElement(S.Formik,{initialValues:$,onSubmit:ne,validationSchema:q,validateOnChange:!1},U=>{let{errors:w,handleChange:X,values:j}=U;return e.createElement(s.Form,null,e.createElement(a.ModalBody,null,e.createElement(a.Stack,{spacing:6},I!=="create"&&e.createElement(ae,{registrationToken:Q}),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},P({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Stack,{spacing:1},e.createElement(a.Grid,{gap:5},x.map(re=>re.map(L=>e.createElement(a.GridItem,(0,g.Z)({key:L.name},L.size),e.createElement(s.GenericInput,(0,g.Z)({},L,{disabled:H,error:w[L.name],onChange:X,value:j[L.name]}))))))))),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},P({id:"global.roles",defaultMessage:"User's role"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Grid,{gap:5},e.createElement(a.GridItem,{col:6,xs:12},e.createElement(W.Z,{disabled:H,error:w.roles,onChange:X,value:j.roles})),te.map(re=>re.map(L=>e.createElement(a.GridItem,(0,g.Z)({key:L.name},L.size),e.createElement(s.GenericInput,(0,g.Z)({},L,{disabled:H,onChange:X,value:j[L.name]})))))))))),e.createElement(a.ModalFooter,{startActions:e.createElement(a.Button,{variant:"tertiary",onClick:f,type:"button"},P({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:_e}))}))};J.propTypes={onToggle:n().func.isRequired,queryName:n().array.isRequired};var se=J;const V=({pagination:d})=>e.createElement(a.Box,{paddingTop:4},e.createElement(a.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.PageSizeURLQuery,null),e.createElement(s.PaginationURLQuery,{pagination:d})));V.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},V.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};var b=V;const ie=async(d,M)=>{const{get:f}=(0,s.getFetchClient)(),{data:{data:I}}=await f(`/admin/users${d}`);return M(),I},ce=async d=>{const{post:M}=(0,s.getFetchClient)();await M("/admin/users/batch-delete",{ids:d})};var de=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],ue=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:d},{formatMessage:M}){return e.createElement(a.Typography,{textColor:"neutral800"},d.map(f=>M({id:`Settings.permissions.users.${f.code}`,defaultMessage:f.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:d},{formatMessage:M}){return e.createElement(a.Flex,null,e.createElement(s.Status,{isActive:d,variant:d?"success":"danger"}),e.createElement(a.Typography,{textColor:"neutral800"},M({id:d?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:d?"Active":"Inactive"})))}}];const me=(()=>window&&window.strapi&&window.strapi.isEE?t(99724).Z:t(9814).Z)(),Ee=(()=>window&&window.strapi&&window.strapi.isEE?t(21306).Z:t(83119).Z)();var pe=()=>{const{formatAPIError:d}=(0,s.useAPIErrorHandler)(),[M,f]=(0,e.useState)(!1),{allowedActions:{canCreate:I,canDelete:N,canRead:h}}=(0,s.useRBAC)(r.Z.settings.users),B=(0,o.useQueryClient)(),Q=(0,s.useNotification)(),{formatMessage:T}=(0,u.useIntl)(),{search:Z}=(0,i.useLocation)();(0,s.useFocusWhenNavigate)(),Ee();const{notifyStatus:P}=(0,a.useNotifyAT)(),c=["users",Z],z=ue.map(E=>({...E,metadatas:{...E.metadatas,label:T(E.metadatas.label)}})),v=T({id:"global.users",defaultMessage:"Users"}),G=()=>{P(T({id:"app.utils.notify.data-loaded",defaultMessage:"The {target} has loaded"},{target:v}))},{status:R,data:F,isFetching:ne}=(0,o.useQuery)(c,()=>ie(Z,G),{enabled:h,retry:!1,onError(E){Q({type:"warning",message:{id:"notification.error",message:d(E),defaultMessage:"An error occured"}})}}),Y=()=>{f(E=>!E)},k=(0,o.useMutation)(E=>ce(E),{async onSuccess(){await B.refetchQueries(c),await B.refetchQueries(["ee","license-limit-info"])},onError(E){Q({type:"warning",message:{id:"notification.error",message:d(E),defaultMessage:"An error occured"}})}}),H=R!=="success"&&R!=="error"||R==="success"&&ne;return e.createElement(a.Main,{"aria-busy":H},e.createElement(s.SettingsPageTitle,{name:"Users"}),e.createElement(a.HeaderLayout,{primaryAction:I&&e.createElement(me,{onClick:Y}),title:v,subtitle:T({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),h&&e.createElement(a.ActionLayout,{startActions:e.createElement(e.Fragment,null,e.createElement(s.SearchURLQuery,{label:T({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:v})}),e.createElement(A.Z,{displayedFilters:de}))}),e.createElement(a.ContentLayout,{canRead:h},!h&&e.createElement(s.NoPermissions,null),R==="error"&&e.createElement("div",null,"TODO: An error occurred"),h&&e.createElement(e.Fragment,null,e.createElement(s.DynamicTable,{contentType:"Users",isLoading:H,onConfirmDeleteAll:k.mutateAsync,onConfirmDelete:E=>k.mutateAsync([E]),headers:z,rows:F?.results,withBulkActions:!0,withMainAction:N},e.createElement(C,{canDelete:N,headers:z,rows:F?.results||[],withBulkActions:!0,withMainAction:N})),e.createElement(b,{pagination:F?.pagination}))),M&&e.createElement(se,{onToggle:Y,queryName:c}))},ge=()=>e.createElement(s.CheckPagePermissions,{permissions:r.Z.settings.users.main},e.createElement(pe,null))},76779:function(y,l,t){var e=t(32735),s=t(60216),r=t.n(s),a=t(39161),i=t.n(a),u=t(13478),o=t.n(u),_=t(57269),n=t.n(_),m=t(59087),D=t.n(m),p=t(5636);const C=({children:A,target:g})=>{const S=(0,u.useNotification)(),{formatMessage:W}=(0,p.useIntl)(),K=()=>{S({type:"info",message:{id:"notification.link-copied"}})},x=W({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return e.createElement(u.ContentBox,{endAction:e.createElement(m.CopyToClipboard,{onCopy:K,text:g},e.createElement(a.IconButton,{label:x,noBorder:!0,icon:e.createElement(_.Duplicate,null)})),title:g,titleEllipsis:!0,subtitle:A,icon:e.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};C.propTypes={children:r().oneOfType([r().element,r().string]).isRequired,target:r().string.isRequired},l.Z=C},16325:function(y,l,t){var e=t(32735),s=t(5636),r=t(60216),a=t.n(r),i=t(463),u=t(76779);const o=({registrationToken:_})=>{const{formatMessage:n}=(0,s.useIntl)(),m=`${window.location.origin}${i.Z}auth/register?registrationToken=${_}`;return e.createElement(u.Z,{target:m},n({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};o.defaultProps={registrationToken:""},o.propTypes={registrationToken:a().string},l.Z=o},4397:function(y,l,t){var e=t(32735),s=t(60216),r=t.n(s),a=t(5636),i=t(39161),u=t.n(i),o=t(84968),_=t.n(o),n=t(83292),m=t(57269),D=t.n(m),p=t(13478),C=t.n(p);const A=n.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,g=n.default.div`
  animation: ${A} 2s infinite linear;
`,S=()=>e.createElement(g,null,e.createElement(m.Loader,null)),W=async()=>{const{get:x}=(0,p.getFetchClient)(),{data:O}=await x("/admin/roles");return O.data},K=({disabled:x,error:O,onChange:oe,value:q})=>{const{status:le,data:ee}=(0,o.useQuery)(["roles"],W,{staleTime:5e4}),{formatMessage:$}=(0,a.useIntl)(),te=O?$({id:O,defaultMessage:O}):"",ae=$({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),J=$({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),se=$({id:"app.components.Select.placeholder",defaultMessage:"Select"}),V=le==="loading"?e.createElement(S,null):void 0;return e.createElement(i.Select,{id:"roles",disabled:x,error:te,hint:J,label:ae,name:"roles",onChange:b=>{oe({target:{name:"roles",value:b}})},placeholder:se,multi:!0,startIcon:V,value:q,withTags:!0,required:!0},(ee||[]).map(b=>e.createElement(i.Option,{key:b.id,value:b.id},$({id:`global.${b.code}`,defaultMessage:b.name}))))};K.defaultProps={disabled:!1,error:void 0},K.propTypes={disabled:r().bool,error:r().string,onChange:r().func.isRequired,value:r().array.isRequired},l.Z=K},99724:function(y,l,t){var e=t(32735),s=t(5636),r=t(60216),a=t.n(r),i=t(39161),u=t.n(i),o=t(57269),_=t.n(o),n=t(58414);const m=({onClick:D})=>{const{formatMessage:p}=(0,s.useIntl)(),{license:C}=(0,n.q5)(),{permittedSeats:A,shouldStopCreate:g}=C?.data??{};return e.createElement(i.Stack,{spacing:2,horizontal:!0},A&&g&&e.createElement(i.Tooltip,{description:p({id:"Settings.application.admin-seats.at-limit-tooltip",defaultMessage:"At limit: add seats to invite more users"}),position:"left"},e.createElement(i.Icon,{width:`${14/16}rem`,height:`${14/16}rem`,color:"danger500",as:o.ExclamationMarkCircle})),e.createElement(i.Button,{"data-testid":"create-user-button",onClick:D,startIcon:e.createElement(o.Envelop,null),size:"S",disabled:g},p({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})))};m.propTypes={onClick:a().func.isRequired},l.Z=m},64746:function(y,l,t){var e=t(62658);const s=strapi.features.isEnabled(strapi.features.SSO)?{useSSORegistration:!0}:{},r={...e.Z,...s};l.Z=r},43116:function(y,l){const t=strapi.features.isEnabled(strapi.features.SSO)?[[{intlLabel:{id:"Settings.permissions.users.form.sso",defaultMessage:"Connect with SSO"},hint:{id:"Settings.permissions.users.form.sso.description",defaultMessage:"When enabled (ON), users can login via SSO"},name:"useSSORegistration",type:"bool",size:{col:6,xs:12}}]]:[];l.Z=t},28890:function(y,l,t){var e=t(32735),s=t(5636),r=t(60216),a=t.n(r),i=t(463),u=t(76779);const o=({registrationToken:_})=>{const{formatMessage:n}=(0,s.useIntl)();return _?e.createElement(u.Z,{target:`${window.location.origin}${i.Z}auth/register?registrationToken=${_}`},n({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):e.createElement(u.Z,{target:`${window.location.origin}${i.Z}auth/login`},n({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};o.defaultProps={registrationToken:""},o.propTypes={registrationToken:a().string},l.Z=o}}]);
